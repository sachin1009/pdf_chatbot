<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Chatbot | AI Assistant</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --background-color: #f8f9fa;
            --card-color: #ffffff;
            --text-color: #333333;
            --text-light: #6c757d;
            --border-color: #e9ecef;
            --accent-light: #f0f7ff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .header {
            background-color: var(--card-color);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            flex: 1;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo svg {
            width: 32px;
            height: 32px;
            fill: var(--primary-color);
        }

        h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-color);
        }

        h2 {
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 1rem;
        }

        p {
            color: var(--text-light);
            font-size: 0.95rem;
        }

        .card {
            background-color: var(--card-color);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 10px;
            padding: 3rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upload-area:hover {
            border-color: var(--primary-color);
            background-color: rgba(67, 97, 238, 0.03);
        }

        .upload-icon {
            font-size: 48px;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .file-input {
            display: none;
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 0.75rem 1.5rem;
            font-size: 0.95rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .btn-secondary:hover {
            background-color: rgba(67, 97, 238, 0.1);
        }

        .pdf-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .pdf-icon {
            background-color: #fee2e2;
            border-radius: 8px;
            padding: 12px;
        }

        .pdf-icon svg {
            width: 28px;
            height: 28px;
            fill: #ef4444;
        }

        .pdf-details h3 {
            font-size: 16px;
            margin-bottom: 4px;
        }

        .pdf-details p {
            font-size: 14px;
            color: var(--text-light);
        }

        .preview-text {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            font-family: monospace;
            font-size: 14px;
            line-height: 1.5;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 1rem;
            white-space: pre-wrap;
        }

        .chat-container {
            height: 400px;
            overflow-y: auto;
            margin-bottom: 1rem;
            padding-right: 0.5rem;
        }

        .chat-message {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 8px;
        }

        .chat-message.user {
            background-color: var(--accent-light);
            margin-left: 2rem;
        }

        .chat-message.bot {
            background-color: #f8f9fa;
            border-left: 4px solid var(--primary-color);
            margin-right: 2rem;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 14px;
        }

        .message-header .name {
            font-weight: 600;
        }

        .message-header .time {
            color: var(--text-light);
        }

        .message-content {
            font-size: 15px;
        }

        .input-container {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .chat-input {
            flex: 1;
            padding: 1rem 1.5rem;
            border: 1px solid var(--border-color);
            border-radius: 50px;
            font-size: 15px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .chat-input:focus {
            border-color: var(--primary-color);
        }

        .loader {
            display: none;
            justify-content: center;
            padding: 2rem 0;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid rgba(67, 97, 238, 0.1);
            border-top-color: var(--primary-color);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .feature {
            background-color: var(--card-color);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .feature-icon {
            background-color: rgba(67, 97, 238, 0.1);
            width: 50px;
            height: 50px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .feature-icon svg {
            width: 24px;
            height: 24px;
            fill: var(--primary-color);
        }

        .feature h3 {
            font-size: 18px;
            margin-bottom: 0.5rem;
        }

        .footer {
            text-align: center;
            padding: 2rem 0;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .input-container {
                flex-direction: column;
            }
            
            .chat-input {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <div class="logo">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20M10,19H8V18H10V19M10,17H8V16H10V17M10,15H8V14H10V15M14,19H12V18H14V19M14,17H12V16H14V17M14,15H12V14H14V15Z" />
                    </svg>
                    <h1>PDF Chatbot</h1>
                </div>
                <p>Upload any PDF document and ask questions using AI-powered assistance</p>
            </div>
        </header>

        <!-- Features Section -->
        <section class="features">
            <div class="feature">
                <div class="feature-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M9,10V12H7V10H9M13,10V12H11V10H13M17,10V12H15V10H17M19,3A2,2 0 0,1 21,5V19A2,2 0 0,1 19,21H5C3.89,21 3,20.1 3,19V5A2,2 0 0,1 5,3H19M9,14V16H7V14H9M13,14V16H11V14H13M19,19V8H5V19H19M17,14V16H15V14H17Z" />
                    </svg>
                </div>
                <h3>Upload PDF Documents</h3>
                <p>Seamlessly upload and process any PDF file with our intuitive interface.</p>
            </div>
            <div class="feature">
                <div class="feature-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M20,2H4A2,2 0 0,0 2,4V22L6,18H20A2,2 0 0,0 22,16V4A2,2 0 0,0 20,2M6,9H18V11H6M14,14H6V12H14M18,8H6V6H18" />
                    </svg>
                </div>
                <h3>Interactive Chatbot</h3>
                <p>Ask questions about your documents and get accurate, AI-powered answers.</p>
            </div>
            <div class="feature">
                <div class="feature-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M17,22V20H20V17H22V20.5C22,21.32 21.32,22 20.5,22H17M7,22H3.5C2.68,22 2,21.32 2,20.5V17H4V20H7V22M17,2H20.5C21.32,2 22,2.68 22,3.5V7H20V4H17V2M3.5,2H7V4H4V7H2V3.5C2,2.68 2.68,2 3.5,2M10,6V8H14V6H10M10,10V12H14V10H10M10,14V16H14V14H10M16,6H18V18H16V6M6,6H8V18H6V6Z" />
                    </svg>
                </div>
                <h3>Powered by Mistral AI</h3>
                <p>Leveraging advanced AI technology to extract insights from your documents.</p>
            </div>
        </section>

        <!-- Upload Section -->
        <div id="upload-section" class="card">
            <h2>Upload Your PDF</h2>
            <div id="upload-area" class="upload-area">
                <div class="upload-icon">📄</div>
                <p>Drag and drop your PDF file here<br>or click to browse</p>
                <input type="file" id="file-input" class="file-input" accept=".pdf">
            </div>
        </div>

        <!-- PDF Preview Section (Initially Hidden) -->
        <div id="pdf-preview" class="card hidden">
            <div class="pdf-info">
                <div class="pdf-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M20,2H8C6.9,2 6,2.9 6,4V16C6,17.1 6.9,18 8,18H20C21.1,18 22,17.1 22,16V4C22,2.9 21.1,2 20,2M20,16H8V4H20V16M4,6H2V20C2,21.1 2.9,22 4,22H18V20H4V6M16,12V9C16,8.45 15.55,8 15,8H13V13H15C15.55,13 16,12.55 16,12M14,9H15V12H14V9M18,11H19V10H18V9H19V8H17V13H18V11M9,9H12V10H10V11H12V12H10V13H9V9Z" />
                    </svg>
                </div>
                <div class="pdf-details">
                    <h3 id="pdf-name">document.pdf</h3>
                    <p id="pdf-info">Loading...</p>
                </div>
                <button id="new-pdf" class="btn btn-secondary">Upload New</button>
            </div>
            
            <h3>Content Preview</h3>
            <div id="preview-text" class="preview-text">Loading PDF content...</div>
        </div>

        <!-- Chat Section (Initially Hidden) -->
        <div id="chat-section" class="card hidden">
            <h2>Ask Questions About Your PDF</h2>
            <div id="chat-container" class="chat-container">
                <!-- Chat messages will be inserted here -->
            </div>
            <div class="input-container">
                <input type="text" id="chat-input" class="chat-input" placeholder="Type your question about the PDF...">
                <button id="send-btn" class="btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                    Send
                </button>
            </div>
        </div>

        <!-- Loading Spinner -->
        <div id="loader" class="loader">
            <div class="spinner"></div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <p>Powered by Mistral AI • PDF Chatbot © 2025</p>
        </footer>
    </div>

    <script>
        // DOM Elements
        const uploadSection = document.getElementById('upload-section');
        const pdfPreview = document.getElementById('pdf-preview');
        const chatSection = document.getElementById('chat-section');
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');
        const pdfName = document.getElementById('pdf-name');
        const pdfInfo = document.getElementById('pdf-info');
        const previewText = document.getElementById('preview-text');
        const newPdfBtn = document.getElementById('new-pdf');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const chatContainer = document.getElementById('chat-container');
        const loader = document.getElementById('loader');

        // Store PDF text for queries
        let fullPdfText = '';

        // Event listeners
        uploadArea.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#4361ee';
            uploadArea.style.backgroundColor = 'rgba(67, 97, 238, 0.05)';
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.borderColor = '#e9ecef';
            uploadArea.style.backgroundColor = 'transparent';
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#e9ecef';
            uploadArea.style.backgroundColor = 'transparent';
            
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type === 'application/pdf') {
                uploadPdf(files[0]);
            } else {
                alert('Please upload a PDF file.');
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                uploadPdf(e.target.files[0]);
            }
        });

        newPdfBtn.addEventListener('click', () => {
            uploadSection.classList.remove('hidden');
            pdfPreview.classList.add('hidden');
            chatSection.classList.add('hidden');
            fileInput.value = '';
            fullPdfText = '';
        });

        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendQuestion();
            }
        });

        sendBtn.addEventListener('click', sendQuestion);

        // Functions
        function uploadPdf(file) {
            showLoader();
            
            const formData = new FormData();
            formData.append('file', file);
            
            fetch('/api/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                hideLoader();
                
                if (data.success) {
                    // Update UI
                    pdfName.textContent = data.filename;
                    pdfInfo.textContent = `${data.page_count} pages • ${data.char_count} characters`;
                    previewText.textContent = data.text;
                    fullPdfText = data.full_text;
                    
                    // Show preview and chat sections
                    uploadSection.classList.add('hidden');
                    pdfPreview.classList.remove('hidden');
                    chatSection.classList.remove('hidden');
                    
                    // Add welcome message
                    addBotMessage("Hello! I've processed your PDF. What would you like to know about it?");
                } else {
                    alert('Error: ' + (data.error || 'Failed to process PDF'));
                }
            })
            .catch(error => {
                hideLoader();
                alert('Error: ' + error.message);
            });
        }

        function sendQuestion() {
            const question = chatInput.value.trim();
            if (!question) return;
            
            // Add user message to chat
            addUserMessage(question);
            chatInput.value = '';
            
            // Show loader
            showLoader();
            
            // Send request to API
            fetch('/api/query', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    pdf_text: fullPdfText,
                    question: question
                })
            })
            .then(response => response.json())
            .then(data => {
                hideLoader();
                
                if (data.success) {
                    addBotMessage(data.answer);
                } else {
                    addBotMessage("I'm sorry, I couldn't process your question. Please try again.");
                }
            })
            .catch(error => {
                hideLoader();
                addBotMessage("Sorry, there was an error processing your request. Please try again later.");
            });
        }

        function addUserMessage(message) {
            const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message user';
            
            messageDiv.innerHTML = `
                <div class="message-header">
                    <span class="name">You</span>
                    <span class="time">${timestamp}</span>
                </div>
                <div class="message-content">${message}</div>
            `;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function addBotMessage(message) {
            const timestamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message bot';
            
            messageDiv.innerHTML = `
                <div class="message-header">
                    <span class="name">AI Assistant</span>
                    <span class="time">${timestamp}</span>
                </div>
                <div class="message-content">${message}</div>
            `;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function showLoader() {
            loader.style.display = 'flex';
        }

        function hideLoader() {
            loader.style.display = 'none';
        }
    </script>
</body>
</html>